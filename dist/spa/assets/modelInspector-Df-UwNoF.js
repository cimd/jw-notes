import{n as M,k as O,l as _,i as b,o as L,p as A,g as R}from"./isTypedArray-3TB5rZnQ.js";import{_ as F,b as n,r as d,E as x}from"./Api-twcc0JN0.js";import{A as g}from"./Action-D-OIYPpf.js";import{u as D}from"./index-DjwF1BFA.js";import{a0 as y,q as I}from"./index-BtKb8wT8.js";function V(e,t){for(var a=-1,s=e==null?0:e.length;++a<s&&t(e[a],a,e)!==!1;);return e}var T=V;function U(e){return function(t,a,s){for(var i=-1,o=Object(t),l=s(t),u=l.length;u--;){var v=l[e?u:++i];if(a(o[v],v,o)===!1)break}return t}}var j=U,P=j,C=P(),B=C;function k(e,t){for(var a=-1,s=Array(e);++a<e;)s[a]=t(a);return s}var K=k,q=K,z=M,H=b,N=O,G=F,J=_,Q=Object.prototype,W=Q.hasOwnProperty;function X(e,t){var a=H(e),s=!a&&z(e),i=!a&&!s&&N(e),o=!a&&!s&&!i&&J(e),l=a||s||i||o,u=l?q(e.length,String):[],v=u.length;for(var h in e)(t||W.call(e,h))&&!(l&&(h=="length"||i&&(h=="offset"||h=="parent")||o&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||G(h,v)))&&u.push(h);return u}var Y=X,Z=Object.prototype;function tt(e){var t=e&&e.constructor,a=typeof t=="function"&&t.prototype||Z;return e===a}var et=tt;function at(e,t){return function(a){return e(t(a))}}var st=at,it=st,rt=it(Object.keys,Object),nt=rt,ot=et,dt=nt,ht=Object.prototype,lt=ht.hasOwnProperty;function ct(e){if(!ot(e))return dt(e);var t=[];for(var a in Object(e))lt.call(e,a)&&a!="constructor"&&t.push(a);return t}var ut=ct,vt=L,pt=A;function gt(e){return e!=null&&pt(e.length)&&!vt(e)}var S=gt,ft=Y,yt=ut,mt=S;function wt(e){return mt(e)?ft(e):yt(e)}var Et=wt,$t=B,bt=Et;function St(e,t){return e&&$t(e,t,bt)}var Mt=St,Ot=S;function _t(e,t){return function(a,s){if(a==null)return a;if(!Ot(a))return e(a,s);for(var i=a.length,o=t?i:-1,l=Object(a);(t?o--:++o<i)&&s(l[o],o,l)!==!1;);return a}}var Lt=_t,At=Mt,Rt=Lt,Ft=Rt(At),xt=Ft;function Dt(e){return e}var It=Dt,Vt=It;function Tt(e){return typeof e=="function"?e:Vt}var Ut=Tt,jt=T,Pt=xt,Ct=Ut,Bt=b;function kt(e,t){var a=Bt(e)?jt:Pt;return a(e,Ct(t))}var Kt=kt;const w=R(Kt);var m=(e=>(e.CREATED="created",e.READ="read",e.UPDATED="updated",e.DELETED="deleted",e))(m||{});class qt{constructor(){this.$invalid=y({}),this.$model=y({}),this.validations=I(()=>({}))}initValidations(){const t=this.model;this.v$=D(this.validations,{model:t}),this.set$Model(this.v$.value.model),n({title:"Validation Initialized",data:this.v$.value.model})}$validate(){return this.v$.value.$validate(),this.$invalid=this.v$.value.$invalid,d().then(),n({title:"Validation Response",data:{valid:!this.v$.value.$invalid,invalid:this.v$.value.$invalid,model:this.v$.value.model}}),!this.v$.value.$invalid}$reset(){this.v$.value.$reset(),Object.assign(this.$invalid,this.v$.value.$invalid),d().then(),n({title:"Validation Reset",data:this.v$.value.model})}set$Model(t){Object.assign(this.$model,t),d().then()}}class c extends x{constructor(t,a){super(t,a),this.name=this.constructor.name}}var r=[];for(var f=0;f<256;++f)r.push((f+256).toString(16).slice(1));function zt(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}var p,Ht=new Uint8Array(16);function Nt(){if(!p&&(p=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(Ht)}var Gt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const E={randomUUID:Gt};function Jt(e,t,a){if(E.randomUUID&&!t&&!e)return E.randomUUID();e=e||{};var s=e.random||(e.rng||Nt)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,zt(s)}const Qt=e=>{console.log(e),e.forEach(t=>{})};class Wt extends qt{constructor(){super(),this.state=y({isLoading:!1,isSuccess:!0,isError:!1}),this.errors=[],this.isValid=!0,this.isInvalid=!1,this.originalModel={},this.protected=["id","created_at","updated_at","deleted_at"],this.defaultModel={},this.uuid=Jt(),Zt(this).then(),n({title:"Model Initialized",data:{uuid:this.uuid}})}static async find(t){const a=this.instance();return await a.find(t),a}static instance(){return new this}async find(t){this.setStateLoading(),typeof this.defaultModel>"u"&&Object.assign(this.defaultModel,this.model);try{this.retrieving();const a=await this.api.show(t);this.setModel(a.data),n({title:"Model Retrieved",data:{model:a.data}}),this.setOriginal(),this.setStateSuccess(),this.retrieved(a.data)}catch(a){throw this.setStateError(),this.retrievingError(a),new c("Find",a)}}async save(t){let a,s="";this.saving();try{return!this.model.id||t===g.CREATE?(a=await this.create(),s=m.CREATED):(a=await this.update(),s=m.UPDATED),this.saved(a),n({title:s,data:{model:a}}),{actioned:s,model:a}}catch(i){throw new c("Find",i)}}async create(){try{this.creating(),this.setStateLoading();const t=await this.api.store(this.model);return this.setOriginal(),this.setModel(t.data),n({title:"Created",data:{model:t.data}}),this.setStateSuccess(),this.created(t.data),t.data}catch(t){throw this.setStateError(),new c("Create",t)}}async update(){try{this.setStateLoading(),this.updating();const t=await this.api.update(this.model);return this.setOriginal(),this.setModel(t.data),n({title:"Updated",data:{model:t.data}}),this.setStateSuccess(),this.updated(t.data),t.data}catch(t){throw this.setStateError(),new c("Update",t)}}async delete(){try{this.deleting(),this.setStateLoading();const t=await this.api.destroy(this.model);return this.setOriginal(),this.setModel(t.data),n({title:"Deleted",data:{model:t.data}}),this.setStateSuccess(),this.deleted(t.data),t.data}catch(t){throw this.setStateError(),new c("Delete",t)}}async logs(){this.setStateLoading();try{const t=await this.api.logs(this.model.id);return this.setStateSuccess(),t.data}catch(t){throw this.setStateError(),new c("Logs",t)}}fresh(){this.setModel(this.defaultModel),n({title:"Fresh Model",data:{model:this.defaultModel}})}async refresh(t){try{this.setStateLoading(),this.retrieving();const a=t||this.model.id,s=await this.api.show(a);this.setOriginal(),this.setStateSuccess(),this.factory(s.data),this.retrieved(s.data),n({title:"Refreshed",data:{model:s.data}})}catch(a){throw this.setStateError(),this.retrievingError(a),new c("Refresh",a)}}getOriginal(){return this.originalModel}async load(t){switch(typeof t){case"string":this.model[t]=await this[t]().get();break;case"object":for(const a of t)this.model[a]=await this[a]().get();break}d().then()}async hasOne(t,a){const s=t.getResource();return await this.api.hasOne(s,a).get()}hasMany(t,a){const s=t.getResource();return{get:async()=>await this.api.hasMany(s,a).get(),show:async i=>await this.api.hasMany(s,a).show(i),create:async i=>await this.api.hasMany(s,a).store(i),update:async i=>await this.api.hasMany(s,a).update(i),delete:async i=>await this.api.hasMany(s,a).delete(i.id)}}async getValidationRules(t){let a=[];try{return!this.model.id||t===g.CREATE?a=(await this.api.storeValidationRules(this.model)).data:a=(await this.api.updateValidationRules(this.model)).data,this.errors=[],this.isValid=!0,this.isInvalid=!1,console.log(a),this.setRulesFromServer(a),a}catch(s){return this.errors=s.data.errors,this.isValid=!1,this.isInvalid=!0,!1}}setRulesFromServer(t){console.log(this.validations),w(t,(a,s)=>{console.log(s,a);const i=Qt(a);console.log(i)})}async validate(t){try{return!this.model.id||t===g.CREATE?await this.api.validateStore(this.model):await this.api.validateUpdate(this.model),this.errors=[],this.isValid=!0,this.isInvalid=!1,!0}catch(a){return this.errors=a.data.errors,this.isValid=!1,this.isInvalid=!0,!1}}getDefault(t){return this.parameters[t]}factory(t){this.defaultModel=Object.assign({},this.model),t&&this.setModel(t),w(this.parameters,(a,s)=>{this.model[s]===void 0&&(this.model[s]=a)}),this.setOriginal()}setModel(t){Object.assign(this.model,t),d().then()}setOriginal(){Object.assign(this.originalModel,this.model),d().then()}retrieving(){}retrieved(t){}retrievingError(t){}creating(){}created(t){}updating(){}updated(t){}saving(){}saved(t){}deleting(){}deleted(t){}setStateLoading(){this.state.isLoading=!0,this.state.isSuccess=!0,this.state.isError=!1,d().then(),n({title:"Loading",data:this.state})}setStateSuccess(){this.state.isLoading=!1,this.state.isSuccess=!0,this.state.isError=!1,d().then(),n({title:"Loading success",data:this.state})}setStateError(){this.state.isLoading=!1,this.state.isSuccess=!1,this.state.isError=!0,d().then(),n({title:"Loading error",data:this.state})}}const $=[],Xt=[],Yt=[],Zt=async e=>{if(!e)throw new Error("Model is not defined");const t=e instanceof Wt?"model":"collection";$.push(e),Xt.push({id:e.uuid,label:e.constructor.name+"-"+$.length,type:t}),Yt.push({id:e.uuid,model:e,type:t}),await d()};export{Wt as M,Zt as a,Et as k,Jt as v};
