import{Q as je}from"./QDialog-BSwpd-ms.js";import{b as Ae,u as Be,c as Ie,e as Te,_ as J,f as Fe}from"./components-BkkrhxcC.js";import{q as r,m as de,g as ve,a as P,w as ne,C as Ke,s,n as Qe,z as $e,T as Le,L as Ne}from"./index-CPXBor41.js";import{Q as Ye}from"./QBtn-LIf1TL9v.js";import{T as ze}from"./TouchPan-DCwgKmrA.js";import{u as Ee,a as We}from"./use-dark-BVUz_ulx.js";import{b as Je,j as Ue,k as Xe}from"./use-file-dom-props-6q2ASvdB.js";import{p as x}from"./QItem-xZmXR_F9.js";import{h as Ge}from"./render-D-1utwwR.js";import{v as Ze}from"./vm-B61G6sTM.js";const Re=["gregorian","persian"],ce={mask:{type:String},locale:Object,calendar:{type:String,validator:t=>Re.includes(t),default:"gregorian"},landscape:Boolean,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,readonly:Boolean,disable:Boolean},et=["update:modelValue"];function tt(t){return t.year+"/"+x(t.month)+"/"+x(t.day)}function nt(t,C){const M=r(()=>t.disable!==!0&&t.readonly!==!0),D=r(()=>M.value===!0?0:-1),y=r(()=>{const f=[];return t.color!==void 0&&f.push(`bg-${t.color}`),t.textColor!==void 0&&f.push(`text-${t.textColor}`),f.join(" ")});function H(){return t.locale!==void 0?{...C.lang.date,...t.locale}:C.lang.date}function h(f){const b=new Date,w=f===!0?null:0;if(t.calendar==="persian"){const q=Ae(b);return{year:q.jy,month:q.jm,day:q.jd}}return{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate(),hour:w,minute:w,second:w,millisecond:w}}return{editable:M,tabindex:D,headerClass:y,getLocale:H,getCurrentDate:h}}const ht=de({name:"QPopupProxy",props:{...Be,breakpoint:{type:[String,Number],default:450}},emits:["show","hide"],setup(t,{slots:C,emit:M,attrs:D}){const{proxy:y}=ve(),{$q:H}=y,h=P(!1),f=P(null),b=r(()=>parseInt(t.breakpoint,10)),{canShow:w}=Ie({showing:h});function q(){return H.screen.width<b.value||H.screen.height<b.value?"dialog":"menu"}const S=P(q()),V=r(()=>S.value==="menu"?{maxHeight:"99vh"}:{});ne(()=>q(),d=>{h.value!==!0&&(S.value=d)});function j(d){h.value=!0,M("show",d)}function F(d){h.value=!1,S.value=q(),M("hide",d)}return Object.assign(y,{show(d){w(d)===!0&&f.value.show(d)},hide(d){f.value.hide(d)},toggle(d){f.value.toggle(d)}}),Ke(y,"currentComponent",()=>({type:S.value,ref:f.value})),()=>{const d={ref:f,...V.value,...D,onShow:j,onHide:F};let p;return S.value==="dialog"?p=je:(p=Te,Object.assign(d,{target:t.target,contextMenu:t.contextMenu,noParentEvent:!0,separateClosePopup:!0})),s(p,d,C.default)}}});function ut(t,C){return t.hour!==null&&t.minute===null?"minute":"hour"}function lt(){const t=new Date;return{hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds()}}const gt=de({name:"QTime",props:{...Ee,...Je,...ce,modelValue:{required:!0,validator:t=>typeof t=="string"||t===null},mask:{...ce.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:t=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(t)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:et,setup(t,{slots:C,emit:M}){const D=ve(),{$q:y}=D.proxy,H=We(t,y),{tabindex:h,headerClass:f,getLocale:b,getCurrentDate:w}=nt(t,y),q=Ue(t),S=Xe(q);let V,j;const F=P(null),d=r(()=>ke()),p=r(()=>b()),ue=r(()=>_e()),K=J(t.modelValue,d.value,p.value,t.calendar,ue.value),i=P(ut(K)),u=P(K),v=P(K.hour===null||K.hour<12),fe=r(()=>`q-time q-time--${t.landscape===!0?"landscape":"portrait"}`+(H.value===!0?" q-time--dark q-dark":"")+(t.disable===!0?" disabled":t.readonly===!0?" q-time--readonly":"")+(t.bordered===!0?" q-time--bordered":"")+(t.square===!0?" q-time--square no-border-radius":"")+(t.flat===!0?" q-time--flat no-shadow":"")),U=r(()=>{const e=u.value;return{hour:e.hour===null?"--":g.value===!0?x(e.hour):String(v.value===!0?e.hour===0?12:e.hour:e.hour>12?e.hour-12:e.hour),minute:e.minute===null?"--":x(e.minute),second:e.second===null?"--":x(e.second)}}),g=r(()=>t.format24h!==null?t.format24h:y.lang.date.format24h),me=r(()=>{const e=i.value==="hour",n=e===!0?12:60,l=u.value[i.value];let c=`rotate(${Math.round(l*(360/n))-180}deg) translateX(-50%)`;return e===!0&&g.value===!0&&u.value.hour>=12&&(c+=" scale(.7)"),{transform:c}}),le=r(()=>u.value.hour!==null),he=r(()=>le.value===!0&&u.value.minute!==null),A=r(()=>t.hourOptions!==void 0?e=>t.hourOptions.includes(e):t.options!==void 0?e=>t.options(e,null,null):null),Q=r(()=>t.minuteOptions!==void 0?e=>t.minuteOptions.includes(e):t.options!==void 0?e=>t.options(u.value.hour,e,null):null),$=r(()=>t.secondOptions!==void 0?e=>t.secondOptions.includes(e):t.options!==void 0?e=>t.options(u.value.hour,u.value.minute,e):null),_=r(()=>{if(A.value===null)return null;const e=N(0,11,A.value),n=N(12,11,A.value);return{am:e,pm:n,values:e.values.concat(n.values)}}),B=r(()=>Q.value!==null?N(0,59,Q.value):null),I=r(()=>$.value!==null?N(0,59,$.value):null),L=r(()=>{switch(i.value){case"hour":return _.value;case"minute":return B.value;case"second":return I.value}}),ge=r(()=>{let e,n,l=0,o=1;const c=L.value!==null?L.value.values:void 0;i.value==="hour"?g.value===!0?(e=0,n=23):(e=0,n=11,v.value===!1&&(l=12)):(e=0,n=55,o=5);const k=[];for(let a=e,m=e;a<=n;a+=o,m++){const O=a+l,He=c!==void 0&&c.includes(O)===!1,Ve=i.value==="hour"&&a===0?g.value===!0?"00":"12":a;k.push({val:O,index:m,disable:He,label:Ve})}return k}),ye=r(()=>[[ze,be,void 0,{stop:!0,prevent:!0,mouse:!0}]]);ne(()=>t.modelValue,e=>{const n=J(e,d.value,p.value,t.calendar,ue.value);(n.dateHash!==u.value.dateHash||n.timeHash!==u.value.timeHash)&&(u.value=n,n.hour===null?i.value="hour":v.value=n.hour<12)}),ne([d,p],()=>{Qe(()=>{te()})});function ae(){const e={...w(),...lt()};te(e),Object.assign(u.value,e),i.value="hour"}function N(e,n,l){const o=Array.apply(null,{length:n+1}).map((c,k)=>{const a=k+e;return{index:a,val:l(a)===!0}}).filter(c=>c.val===!0).map(c=>c.index);return{min:o[0],max:o[o.length-1],values:o,threshold:n+1}}function oe(e,n,l){const o=Math.abs(e-n);return Math.min(o,l-o)}function X(e,{min:n,max:l,values:o,threshold:c}){if(e===n)return n;if(e<n||e>l)return oe(e,n,c)<=oe(e,l,c)?n:l;const k=o.findIndex(O=>e<=O),a=o[k-1],m=o[k];return e-a<=m-e?a:m}function ke(){return t.calendar!=="persian"&&t.mask!==null?t.mask:`HH:mm${t.withSeconds===!0?":ss":""}`}function _e(){if(typeof t.defaultDate!="string"){const e=w(!0);return e.dateHash=tt(e),e}return J(t.defaultDate,"YYYY/MM/DD",void 0,t.calendar)}function G(){return Ze(D)===!0||L.value!==null&&(L.value.values.length===0||i.value==="hour"&&g.value!==!0&&_.value[v.value===!0?"am":"pm"].values.length===0)}function Z(){const e=F.value,{top:n,left:l,width:o}=e.getBoundingClientRect(),c=o/2;return{top:n+c,left:l+c,dist:c*.7}}function be(e){if(G()!==!0){if(e.isFirst===!0){V=Z(),j=Y(e.evt,V);return}j=Y(e.evt,V,j),e.isFinal===!0&&(V=!1,j=null,ie())}}function ie(){i.value==="hour"?i.value="minute":t.withSeconds&&i.value==="minute"&&(i.value="second")}function Y(e,n,l){const o=$e(e),c=Math.abs(o.top-n.top),k=Math.sqrt(Math.pow(Math.abs(o.top-n.top),2)+Math.pow(Math.abs(o.left-n.left),2));let a,m=Math.asin(c/k)*(180/Math.PI);if(o.top<n.top?m=n.left<o.left?90-m:270+m:m=n.left<o.left?m+90:270-m,i.value==="hour"){if(a=m/30,_.value!==null){const O=g.value!==!0?v.value===!0:_.value.am.values.length!==0&&_.value.pm.values.length!==0?k>=n.dist:_.value.am.values.length!==0;a=X(a+(O===!0?0:12),_.value[O===!0?"am":"pm"])}else a=Math.round(a),g.value===!0?k<n.dist?a<12&&(a+=12):a===12&&(a=0):v.value===!0&&a===12?a=0:v.value===!1&&a!==12&&(a+=12);g.value===!0&&(v.value=a<12)}else a=Math.round(m/6)%60,i.value==="minute"&&B.value!==null?a=X(a,B.value):i.value==="second"&&I.value!==null&&(a=X(a,I.value));return l!==a&&Se[i.value](a),a}const R={hour(){i.value="hour"},minute(){i.value="minute"},second(){i.value="second"}};function we(e){e.keyCode===13&&se()}function qe(e){e.keyCode===13&&re()}function pe(e){G()!==!0&&(y.platform.is.desktop!==!0&&Y(e,Z()),ie())}function xe(e){G()!==!0&&Y(e,Z())}function Ce(e){if(e.keyCode===13)i.value="hour";else if([37,39].includes(e.keyCode)){const n=e.keyCode===37?-1:1;if(_.value!==null){const l=g.value===!0?_.value.values:_.value[v.value===!0?"am":"pm"].values;if(l.length===0)return;if(u.value.hour===null)z(l[0]);else{const o=(l.length+l.indexOf(u.value.hour)+n)%l.length;z(l[o])}}else{const l=g.value===!0?24:12,o=g.value!==!0&&v.value===!1?12:0,c=u.value.hour===null?-n:u.value.hour;z(o+(24+c+n)%l)}}}function Me(e){if(e.keyCode===13)i.value="minute";else if([37,39].includes(e.keyCode)){const n=e.keyCode===37?-1:1;if(B.value!==null){const l=B.value.values;if(l.length===0)return;if(u.value.minute===null)E(l[0]);else{const o=(l.length+l.indexOf(u.value.minute)+n)%l.length;E(l[o])}}else{const l=u.value.minute===null?-n:u.value.minute;E((60+l+n)%60)}}}function De(e){if(e.keyCode===13)i.value="second";else if([37,39].includes(e.keyCode)){const n=e.keyCode===37?-1:1;if(I.value!==null){const l=I.value.values;if(l.length===0)return;if(u.value.seconds===null)W(l[0]);else{const o=(l.length+l.indexOf(u.value.second)+n)%l.length;W(l[o])}}else{const l=u.value.second===null?-n:u.value.second;W((60+l+n)%60)}}}function z(e){u.value.hour!==e&&(u.value.hour=e,T())}function E(e){u.value.minute!==e&&(u.value.minute=e,T())}function W(e){u.value.second!==e&&(u.value.second=e,T())}const Se={hour:z,minute:E,second:W};function se(){v.value===!1&&(v.value=!0,u.value.hour!==null&&(u.value.hour-=12,T()))}function re(){v.value===!0&&(v.value=!1,u.value.hour!==null&&(u.value.hour+=12,T()))}function ee(e){const n=t.modelValue;i.value!==e&&n!==void 0&&n!==null&&n!==""&&typeof n!="string"&&(i.value=e)}function T(){if(A.value!==null&&A.value(u.value.hour)!==!0){u.value=J(),ee("hour");return}if(Q.value!==null&&Q.value(u.value.minute)!==!0){u.value.minute=null,u.value.second=null,ee("minute");return}if(t.withSeconds===!0&&$.value!==null&&$.value(u.value.second)!==!0){u.value.second=null,ee("second");return}u.value.hour===null||u.value.minute===null||t.withSeconds===!0&&u.value.second===null||te()}function te(e){const n=Object.assign({...u.value},e),l=t.calendar==="persian"?x(n.hour)+":"+x(n.minute)+(t.withSeconds===!0?":"+x(n.second):""):Fe(new Date(n.year,n.month===null?null:n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond),d.value,p.value,n.year,n.timezoneOffset);n.changed=l!==t.modelValue,M("update:modelValue",l,n)}function Oe(){const e=[s("div",{class:"q-time__link "+(i.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:h.value,onClick:R.hour,onKeyup:Ce},U.value.hour),s("div",":"),s("div",le.value===!0?{class:"q-time__link "+(i.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:h.value,onKeyup:Me,onClick:R.minute}:{class:"q-time__link"},U.value.minute)];t.withSeconds===!0&&e.push(s("div",":"),s("div",he.value===!0?{class:"q-time__link "+(i.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:h.value,onKeyup:De,onClick:R.second}:{class:"q-time__link"},U.value.second));const n=[s("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},e)];return g.value===!1&&n.push(s("div",{class:"q-time__header-ampm column items-between no-wrap"},[s("div",{class:"q-time__link "+(v.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:h.value,onClick:se,onKeyup:we},"AM"),s("div",{class:"q-time__link "+(v.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:h.value,onClick:re,onKeyup:qe},"PM")])),s("div",{class:"q-time__header flex flex-center no-wrap "+f.value},n)}function Pe(){const e=u.value[i.value];return s("div",{class:"q-time__content col relative-position"},[s(Le,{name:"q-transition--scale"},()=>s("div",{key:"clock"+i.value,class:"q-time__container-parent absolute-full"},[s("div",{ref:F,class:"q-time__container-child fit overflow-hidden"},[Ne(s("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:pe,onMousedown:xe},[s("div",{class:"q-time__clock-circle fit"},[s("div",{class:"q-time__clock-pointer"+(u.value[i.value]===null?" hidden":t.color!==void 0?` text-${t.color}`:""),style:me.value}),ge.value.map(n=>s("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${n.index}`+(n.val===e?" q-time__clock-position--active "+f.value:n.disable===!0?" q-time__clock-position--disable":"")},[s("span",n.label)]))])]),ye.value)])])),t.nowBtn===!0?s(Ye,{class:"q-time__now-button absolute",icon:y.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:t.color,textColor:t.textColor,tabindex:h.value,onClick:ae}):null])}return D.proxy.setNow=ae,()=>{const e=[Pe()],n=Ge(C.default);return n!==void 0&&e.push(s("div",{class:"q-time__actions"},n)),t.name!==void 0&&t.disable!==!0&&S(e,"push"),s("div",{class:fe.value,tabindex:-1},[Oe(),s("div",{class:"q-time__main col overflow-auto"},e)])}}});export{ht as Q,et as a,nt as b,gt as c,tt as g,ce as u};
